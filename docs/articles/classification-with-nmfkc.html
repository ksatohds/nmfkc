<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Classification with NMF-LAB • nmfkc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classification with NMF-LAB">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nmfkc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/classification-with-nmfkc.html">Classification with NMF-LAB</a></li>
    <li><a class="dropdown-item" href="../articles/introduction-to-nmfkc.html">Introduction to nmfkc</a></li>
    <li><a class="dropdown-item" href="../articles/nmf-sem-with-nmfkc.html">NMF-SEM with nmfkc</a></li>
    <li><a class="dropdown-item" href="../articles/timeseries-with-nmfkc.html">Time Series Analysis with NMF-VAR</a></li>
    <li><a class="dropdown-item" href="../articles/topic-modeling-with-nmfkc.html">Topic Modeling with nmfkc</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ksatohds/nmfkc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Classification with NMF-LAB</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ksatohds/nmfkc/blob/HEAD/vignettes/classification-with-nmfkc.Rmd" class="external-link"><code>vignettes/classification-with-nmfkc.Rmd</code></a></small>
      <div class="d-none name"><code>classification-with-nmfkc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use the <code>nmfkc</code> package
for <strong>Supervised Classification</strong>, a technique referred to
as <strong>NMF-LAB</strong> (Label-based NMF).</p>
<div class="section level3">
<h3 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h3>
<p>The NMF-LAB approach treats multi-class classification as a matrix
factorization task:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>≈</mo><mi>X</mi><mi>C</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">Y \approx X C A</annotation></semantics></math></p>
<ul>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
(Target):</strong> One-hot encoded matrix of class labels (Classes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math>
Samples).</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
(Input):</strong> Feature matrix or Kernel matrix constructed from
features.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
(Learned Basis):</strong> A mapping matrix between latent factors and
class labels.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
(Coefficient/Parameter):</strong> Captures the relationship between
input
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
and classes.</li>
</ul>
<p><strong>Key Trade-off:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Linear Model
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>F</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">A = Features</annotation></semantics></math>):</strong>
Highly interpretable.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
tells you exactly which feature contributes to which class.</li>
<li>
<strong>Kernel Model
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>K</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>e</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">A = Kernel</annotation></semantics></math>):</strong>
Highly accurate. Handles non-linear boundaries but is harder to
interpret.</li>
</ol>
<p>We will explore this trade-off using the <code>iris</code>
dataset.</p>
<p>First, let’s load the required packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ksatohds/nmfkc" class="external-link">nmfkc</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Package: nmfkc (Version 0.5.7 , released on 16 12 2025 )</span></span>
<span><span class="co">#&gt; https://ksatohds.github.io/nmfkc/</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'palmerpenguins' was built under R version 4.4.2</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="example-1-the-iris-dataset-linear-vs--kernel">Example 1: The Iris Dataset (Linear vs. Kernel)<a class="anchor" aria-label="anchor" href="#example-1-the-iris-dataset-linear-vs--kernel"></a>
</h2>
<p>Our goal is to classify 3 species of iris flowers (<em>setosa,
versicolor, virginica</em>) based on 4 measurements.</p>
<div class="section level3">
<h3 id="data-preparation">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>We convert the species labels into a binary class matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
and normalize the features
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Prepare Labels (Y)</span></span>
<span><span class="va">label_iris</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span></span>
<span><span class="va">Y_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.class.html">nmfkc.class</a></span><span class="op">(</span><span class="va">label_iris</span><span class="op">)</span> <span class="co"># One-hot encoding (3 Classes x 150 Samples)</span></span>
<span><span class="va">rank_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">label_iris</span><span class="op">)</span><span class="op">)</span> <span class="co"># Number of classes</span></span>
<span></span>
<span><span class="co"># 2. Prepare Features (U)</span></span>
<span><span class="co"># Normalize features to [0, 1] range and transpose to (Features x Samples)</span></span>
<span><span class="va">U_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/nmfkc.normalize.html">nmfkc.normalize</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-1-linear-nmf-lab-focus-on-interpretability">Step 1: Linear NMF-LAB (Focus on Interpretability)<a class="anchor" aria-label="anchor" href="#step-1-linear-nmf-lab-focus-on-interpretability"></a>
</h3>
<p>First, we fit a <strong>Linear Model</strong> by using the features
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>
directly as the input matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>.
This allows us to see <strong>“Which feature drives which
class?”</strong> by inspecting the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use Normalized Features directly as A</span></span>
<span><span class="va">A_linear</span> <span class="op">&lt;-</span> <span class="va">U_iris</span></span>
<span></span>
<span><span class="co"># Fit Linear NMF-LAB</span></span>
<span><span class="va">res_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.html">nmfkc</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y_iris</span>, A <span class="op">=</span> <span class="va">A_linear</span>, rank <span class="op">=</span> <span class="va">rank_iris</span>, seed <span class="op">=</span> <span class="fl">123</span>, prefix <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(3,150)~X(3,3)C(3,4)A(4,150)=XB(3,150)...0sec</span></span>
<span></span>
<span><span class="co"># --- Interpretability Check ---</span></span>
<span><span class="co"># The matrix C (Q x R) shows the weight of each Feature (columns) for each Class (rows).</span></span>
<span><span class="co"># Let's look at the estimated weights:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">res_linear</span><span class="op">$</span><span class="va">C</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">#&gt; Class1         0.00        0.87         0.00        0.00</span></span>
<span><span class="co">#&gt; Class2         0.03        0.00         0.57        0.00</span></span>
<span><span class="co">#&gt; Class3         0.01        0.00         0.08        0.78</span></span></code></pre></div>
<p><strong>Interpretation:</strong> Looking at the matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
above:</p>
<ul>
<li>
<strong>Class1 (Setosa):</strong> Has high weights on
<code>Sepal.Width</code> (2nd col).</li>
<li>
<strong>Class3 (Virginica):</strong> Has high weights on
<code>Petal.Length</code> (3rd col) and <code>Petal.Width</code> (4th
col). This “White-box” transparency is the main advantage of the linear
model.</li>
</ul>
<p><strong>Accuracy Check:</strong> We evaluate the model using a
confusion matrix. <em>(Note: Linear models often struggle with
overlapping classes like versicolor and virginica.)</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">res_linear</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">f_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>fitted.label <span class="op">=</span> <span class="va">pred_linear</span>, label <span class="op">=</span> <span class="va">label_iris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             label</span></span>
<span><span class="co">#&gt; fitted.label setosa versicolor virginica</span></span>
<span><span class="co">#&gt;    setosa        50          0         0</span></span>
<span><span class="co">#&gt;    virginica      0         50        50</span></span>
<span></span>
<span><span class="co"># Calculate Accuracy (assuming diagonal correspondence)</span></span>
<span><span class="va">acc_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f_linear</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">f_linear</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Linear Model Accuracy: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_linear</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear Model Accuracy: 66.67%</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-kernel-nmf-lab-focus-on-performance">Step 2: Kernel NMF-LAB (Focus on Performance)<a class="anchor" aria-label="anchor" href="#step-2-kernel-nmf-lab-focus-on-performance"></a>
</h3>
<p>To improve accuracy, we switch to the <strong>Kernel Model</strong>.
We map the features into a high-dimensional space using a Gaussian
kernel.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Optimize Kernel Width (beta)</span></span>
<span><span class="co"># Heuristic estimation of beta</span></span>
<span><span class="va">res_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.beta.nearest.med.html">nmfkc.kernel.beta.nearest.med</a></span><span class="op">(</span><span class="va">U_iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cross-validation for fine-tuning (using generated candidates)</span></span>
<span><span class="va">cv_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.beta.cv.html">nmfkc.kernel.beta.cv</a></span><span class="op">(</span><span class="va">Y_iris</span>, rank <span class="op">=</span> <span class="va">rank_iris</span>, U <span class="op">=</span> <span class="va">U_iris</span>, </span>
<span>                               beta <span class="op">=</span> <span class="va">res_beta</span><span class="op">$</span><span class="va">beta_candidates</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; beta=1.10348457794195...0.1sec</span></span>
<span><span class="co">#&gt; beta=11.0348457794195...0sec</span></span>
<span><span class="co">#&gt; beta=110.348457794195...0sec</span></span>
<span><span class="co">#&gt; beta=1103.48457794195...0sec</span></span>
<span><span class="va">best_beta</span> <span class="op">&lt;-</span> <span class="va">cv_res</span><span class="op">$</span><span class="va">beta</span></span>
<span></span>
<span><span class="co"># 2. Fit Kernel NMF-LAB</span></span>
<span><span class="va">A_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.html">nmfkc.kernel</a></span><span class="op">(</span><span class="va">U_iris</span>, beta <span class="op">=</span> <span class="va">best_beta</span><span class="op">)</span></span>
<span><span class="va">res_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.html">nmfkc</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y_iris</span>, A <span class="op">=</span> <span class="va">A_kernel</span>, rank <span class="op">=</span> <span class="va">rank_iris</span>, seed <span class="op">=</span> <span class="fl">123</span>, prefix <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(3,150)~X(3,3)C(3,150)A(150,150)=XB(3,150)...0sec</span></span>
<span></span>
<span><span class="co"># 3. Prediction and Evaluation</span></span>
<span><span class="va">fitted_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">res_kernel</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">f_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>fitted.label <span class="op">=</span> <span class="va">fitted_label</span>, label <span class="op">=</span> <span class="va">label_iris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             label</span></span>
<span><span class="co">#&gt; fitted.label setosa versicolor virginica</span></span>
<span><span class="co">#&gt;   setosa         50          0         0</span></span>
<span><span class="co">#&gt;   versicolor      0         49         4</span></span>
<span><span class="co">#&gt;   virginica       0          1        46</span></span>
<span></span>
<span><span class="co"># Calculate Accuracy</span></span>
<span><span class="va">acc_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f_kernel</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">f_kernel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Kernel Model Accuracy: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_kernel</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Kernel Model Accuracy: 96.67%</span></span></code></pre></div>
<p><strong>Result:</strong> The accuracy jumps significantly (often
&gt;96%). The kernel successfully separates the complex boundaries.</p>
</div>
<div class="section level3">
<h3 id="visualization-class-prototypes-basis-x">Visualization: Class Prototypes (Basis X)<a class="anchor" aria-label="anchor" href="#visualization-class-prototypes-basis-x"></a>
</h3>
<p>Finally, let’s visualize the Basis Matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
of the successful kernel model. Ideally, it should look like a diagonal
matrix, mapping each Latent Factor to a specific Species.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">res_kernel</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">res_kernel</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>      main <span class="op">=</span> <span class="st">"Basis Matrix X (Kernel Model)\nMapping Factors to Species"</span>,</span>
<span>      axes <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">12</span>, <span class="st">"YlOrRd"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">rank_iris</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res_kernel</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">rank_iris</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res_kernel</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="classification-with-nmfkc_files/figure-html/iris-plot-X-1.png" width="672"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="example-2-the-palmer-penguins-dataset">Example 2: The Palmer Penguins Dataset<a class="anchor" aria-label="anchor" href="#example-2-the-palmer-penguins-dataset"></a>
</h2>
<p>Let’s apply the <strong>Kernel NMF-LAB</strong> workflow to classify
penguin species (<em>Adelie, Chinstrap, Gentoo</em>), focusing on the
<strong>Probabilistic (Soft)</strong> nature of NMF classification.</p>
<div class="section level3">
<h3 id="data-preparation-1">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation-1"></a>
</h3>
<p>We must remove rows with missing values (<code>NA</code>) as the
kernel matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
cannot handle missing entries in the input features.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load and clean data (remove rows with NAs)</span></span>
<span><span class="va">d_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare Y (Labels)</span></span>
<span><span class="va">label_penguins</span> <span class="op">&lt;-</span> <span class="va">d_penguins</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="va">Y_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.class.html">nmfkc.class</a></span><span class="op">(</span><span class="va">label_penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare U (Features)</span></span>
<span><span class="va">U_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/nmfkc.normalize.html">nmfkc.normalize</a></span><span class="op">(</span><span class="va">d_penguins</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting">2. Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>We use the heuristic
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
directly for a quick demonstration.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rank_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">label_penguins</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Heuristic beta estimation</span></span>
<span><span class="va">best_beta_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.beta.nearest.med.html">nmfkc.kernel.beta.nearest.med</a></span><span class="op">(</span><span class="va">U_penguins</span><span class="op">)</span><span class="op">$</span><span class="va">beta</span></span>
<span></span>
<span><span class="co"># 2. Optimization</span></span>
<span><span class="va">A_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.html">nmfkc.kernel</a></span><span class="op">(</span><span class="va">U_penguins</span>, beta <span class="op">=</span> <span class="va">best_beta_penguins</span><span class="op">)</span></span>
<span><span class="va">res_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.html">nmfkc</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y_penguins</span>, A <span class="op">=</span> <span class="va">A_penguins</span>, rank <span class="op">=</span> <span class="va">rank_penguins</span>, </span>
<span>                      seed <span class="op">=</span> <span class="fl">123</span>, prefix <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(3,333)~X(3,3)C(3,333)A(333,333)=XB(3,333)...0.2sec</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-soft-classification">3. Visualizing “Soft” Classification<a class="anchor" aria-label="anchor" href="#visualizing-soft-classification"></a>
</h3>
<p>Unlike many classifiers that only output a final label, NMF provides
a <strong>probability distribution</strong> over classes. The plot below
shows the predicted probability for each penguin.</p>
<ul>
<li>
<strong>Solid Blocks of Color:</strong> Indicate high confidence
predictions.</li>
<li>
<strong>Mixed Colors:</strong> Indicate samples where the model is
uncertain (often on the boundary between species).</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get probabilistic predictions</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">res_penguins</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">probs</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF8C00"</span>, <span class="st">"#9932CC"</span>, <span class="st">"#008B8B"</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Soft Classification Probabilities (Penguins)"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Sample Index"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">label_penguins</span><span class="op">)</span>, </span>
<span>       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF8C00"</span>, <span class="st">"#9932CC"</span>, <span class="st">"#008B8B"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="st">"white"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="classification-with-nmfkc_files/figure-html/penguins-soft-vis-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="evaluation">4. Evaluation<a class="anchor" aria-label="anchor" href="#evaluation"></a>
</h3>
<p>Finally, we calculate the accuracy.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitted_label_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">res_penguins</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">f_penguins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>Predicted <span class="op">=</span> <span class="va">fitted_label_p</span>, Actual <span class="op">=</span> <span class="va">label_penguins</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            Actual</span></span>
<span><span class="co">#&gt; Predicted   Adelie Chinstrap Gentoo</span></span>
<span><span class="co">#&gt;   Adelie       146         0      0</span></span>
<span><span class="co">#&gt;   Chinstrap      0        68      0</span></span>
<span><span class="co">#&gt;   Gentoo         0         0    119</span></span>
<span></span>
<span><span class="va">acc_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f_penguins</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">f_penguins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Penguins Accuracy: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">acc_p</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Penguins Accuracy: 100%</span></span></code></pre></div>
<p>} ```</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kenichi Satoh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
