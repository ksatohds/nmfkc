<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Topic Modeling with nmfkc • nmfkc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Topic Modeling with nmfkc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nmfkc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/classification-with-nmfkc.html">Classification with NMF-LAB</a>
    </li>
    <li>
      <a href="../articles/introduction-to-nmfkc.html">Introduction to nmfkc</a>
    </li>
    <li>
      <a href="../articles/nmf-sem-with-nmfkc.html">NMF-SEM with nmfkc</a>
    </li>
    <li>
      <a href="../articles/timeseries-with-nmfkc.html">Time Series Analysis with NMF-VAR</a>
    </li>
    <li>
      <a href="../articles/topic-modeling-with-nmfkc.html">Topic Modeling with nmfkc</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ksatohds/nmfkc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Topic Modeling with nmfkc</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ksatohds/nmfkc/blob/HEAD/vignettes/topic-modeling-with-nmfkc.Rmd" class="external-link"><code>vignettes/topic-modeling-with-nmfkc.Rmd</code></a></small>
      <div class="hidden name"><code>topic-modeling-with-nmfkc.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Non-negative Matrix Factorization (NMF) is a powerful technique for
topic modeling. By decomposing a document-term matrix, we can
simultaneously discover latent <strong>Topics</strong> (clusters of
words) and their <strong>Trends</strong> (proportions in documents).</p>
<p>This vignette demonstrates how to use the <code>nmfkc</code> package
to analyze the U.S. presidential inaugural addresses using the
<code>quanteda</code> package.</p>
<p>We will cover:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>: Converting text data into a
matrix format suitable for <code>nmfkc</code>.</li>
<li>
<strong>Rank Selection</strong>: Determining the optimal number of
topics using robust Cross-Validation.</li>
<li>
<strong>Standard NMF</strong>: Extracting basic topics and
interpreting key words.</li>
<li>
<strong>Kernel NMF</strong>: Modeling the <strong>temporal
evolution</strong> of topics using the “Year” as a covariate.</li>
</ol>
<p>First, let’s load the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ksatohds/nmfkc" class="external-link">nmfkc</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Package: nmfkc (Version 0.5.8 , released on 20 12 2025 )</span></span>
<span><span class="co">#&gt; https://ksatohds.github.io/nmfkc/</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'quanteda' was built under R version 4.4.2</span></span>
<span><span class="co">#&gt; Package version: 4.2.0</span></span>
<span><span class="co">#&gt; Unicode version: 15.1</span></span>
<span><span class="co">#&gt; ICU version: 74.1</span></span>
<span><span class="co">#&gt; Parallel computing: 32 of 32 threads used.</span></span>
<span><span class="co">#&gt; See https://quanteda.io for tutorials and examples.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>We create a Document-Feature Matrix (DFM) where rows represent
documents and columns represent words.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the corpus from quanteda</span></span>
<span><span class="va">corp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html" class="external-link">corpus</a></span><span class="op">(</span><span class="va">data_corpus_inaugural</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preprocessing: tokenize, remove stopwords, and punctuation</span></span>
<span><span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens</a></span><span class="op">(</span><span class="va">corp</span>, remove_punct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html" class="external-link">tokens_remove</a></span><span class="op">(</span><span class="va">tok</span>, pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"en"</span>, source <span class="op">=</span> <span class="st">"snowball"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create DFM and filter</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm.html" class="external-link">dfm</a></span><span class="op">(</span><span class="va">tok</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm_select.html" class="external-link">dfm_select</a></span><span class="op">(</span><span class="va">df</span>, min_nchar <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># Remove short words (&lt;= 2 chars)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/dfm_trim.html" class="external-link">dfm_trim</a></span><span class="op">(</span><span class="va">df</span>, min_termfreq <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># Remove rare words (appearing &lt; 100 times)</span></span>
<span></span>
<span><span class="co"># --- CRITICAL STEP ---</span></span>
<span><span class="co"># quanteda's DFM is (Documents x Words).</span></span>
<span><span class="co"># nmfkc expects (Words x Documents).</span></span>
<span><span class="co"># We must transpose the matrix.</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co"># Sort by frequency</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span>,<span class="va">index</span><span class="op">]</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="co"># Features (Words) x Samples (Documents)</span></span>
<span><span class="co">#&gt; [1] 67 59</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rank-selection-number-of-topics">2. Rank Selection (Number of Topics)<a class="anchor" aria-label="anchor" href="#rank-selection-number-of-topics"></a>
</h2>
<p>Before fitting the model, we need to decide the number of topics
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">rank</annotation></semantics></math>).
The <code><a href="../reference/nmfkc.rank.html">nmfkc.rank()</a></code> function helps us choose an appropriate
rank.</p>
<p>Here, we set <code>save.time = FALSE</code> to perform
<strong>Element-wise Cross-Validation (Wold’s CV)</strong>. This method
randomly holds out individual matrix elements and evaluates how well the
model predicts them, providing a robust measure for rank selection
(though it takes more computation time).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Evaluate ranks from 2 to 6</span></span>
<span><span class="co"># save.time=FALSE enables the robust Element-wise CV</span></span>
<span><span class="fu"><a href="../reference/nmfkc.rank.html">nmfkc.rank</a></span><span class="op">(</span><span class="va">Y</span>, rank <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, save.time <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span>
<span><span class="co">#&gt; Running Element-wise CV (this may take time)...</span></span>
<span><span class="co">#&gt; Performing Element-wise CV for Q = 2,3,4,5,6 (5-fold)...</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,2)B(2,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,4)B(4,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,5)B(5,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,6)B(6,59)...0sec</span></span></code></pre></div>
<p><img src="topic-modeling-with-nmfkc_files/figure-html/rank-selection-1.png" width="672"></p>
<pre><code><span><span class="co">#&gt; $rank.best</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $criteria</span></span>
<span><span class="co">#&gt;   rank r.squared      ICp      AIC      BIC B.prob.sd.min B.prob.entropy.mean</span></span>
<span><span class="co">#&gt; 1    2 0.5714525 19.39498 8869.595 10440.15     0.3476271           0.5889663</span></span>
<span><span class="co">#&gt; 2    3 0.6129089 27.93205 8717.283 11073.12     0.1582146           0.6624310</span></span>
<span><span class="co">#&gt; 3    4 0.6535278 36.46005 8529.063 11670.18     0.1301392           0.6519002</span></span>
<span><span class="co">#&gt; 4    5 0.6866667 44.99848 8382.099 12308.49     0.1227179           0.6572496</span></span>
<span><span class="co">#&gt; 5    6 0.7186176 53.52984 8207.187 12918.86     0.1151692           0.6642655</span></span>
<span><span class="co">#&gt;   B.prob.max.mean       ARI silhouette      CPCC  dist.cor sigma.ecv</span></span>
<span><span class="co">#&gt; 1       0.8186375        NA  0.7456899 0.9220031 0.9049180  3.287153</span></span>
<span><span class="co">#&gt; 2       0.6805368 0.7493380  0.5141000 0.9041294 0.9128002  3.675603</span></span>
<span><span class="co">#&gt; 3       0.6102601 0.5737936  0.4743689 0.8675133 0.9239746  4.278131</span></span>
<span><span class="co">#&gt; 4       0.5510541 0.6236933  0.3397598 0.8782690 0.9283578  4.621801</span></span>
<span><span class="co">#&gt; 5       0.5142690 0.6637536  0.3059911 0.8701347 0.9274730  4.683195</span></span></code></pre>
<p>Looking at the diagnostics (e.g., the minimum ECV Sigma, the elbow of
the R-squared curve, or high Cophenetic Correlation), let’s assume
<strong>Rank = 3</strong> is a reasonable choice for this overview.</p>
</div>
<div class="section level2">
<h2 id="standard-nmf">3. Standard NMF<a class="anchor" aria-label="anchor" href="#standard-nmf"></a>
</h2>
<p>We fit the standard NMF model
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>≈</mo><mi>X</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">Y \approx XB</annotation></semantics></math>)
with <code>rank = 3</code>. In the context of topic modeling:</p>
<ul>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
(Basis Matrix):</strong> Represents <strong>Topics</strong>
(distribution of words).</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
(Coefficient Matrix):</strong> Represents <strong>Trends</strong>
(distribution of topics across documents).</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="va">res_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.html">nmfkc</a></span><span class="op">(</span><span class="va">Y</span>, rank <span class="op">=</span> <span class="va">rank</span>, seed <span class="op">=</span> <span class="fl">123</span>, prefix <span class="op">=</span> <span class="st">"Topic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)B(3,59)...0sec</span></span>
<span></span>
<span><span class="co"># Check Goodness of Fit (R-squared)</span></span>
<span><span class="va">res_std</span><span class="op">$</span><span class="va">r.squared</span></span>
<span><span class="co">#&gt; [1] 0.6129089</span></span></code></pre></div>
<div class="section level3">
<h3 id="interpreting-topics-keywords">Interpreting Topics (Keywords)<a class="anchor" aria-label="anchor" href="#interpreting-topics-keywords"></a>
</h3>
<p>We can identify the meaning of each topic by looking at the words
with the highest weights in the basis matrix <code>X</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract top 10 words for each topic from X.prob (normalized X)</span></span>
<span><span class="va">Xp</span> <span class="op">&lt;-</span> <span class="va">res_std</span><span class="op">$</span><span class="va">X.prob</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">q</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">rank</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"----- Featured words on Topic ["</span>, <span class="va">q</span>, <span class="st">"] -----"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Xp</span><span class="op">)</span>, <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, <span class="st">") "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">Xp</span><span class="op">[</span>,<span class="va">q</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">[</span><span class="va">Xp</span><span class="op">[</span>,<span class="va">q</span><span class="op">]</span><span class="op">&gt;=</span><span class="fl">0.5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; ----- Featured words on Topic [1] -----</span></span>
<span><span class="co">#&gt;  [1] "government(564) 54.1%" "states(334) 62.7%"     "shall(316) 59.3%"     </span></span>
<span><span class="co">#&gt;  [4] "public(225) 72%"       "united(203) 68.1%"     "union(190) 53.9%"     </span></span>
<span><span class="co">#&gt;  [7] "war(181) 65.4%"        "national(158) 66.8%"   "congress(130) 60.1%"  </span></span>
<span><span class="co">#&gt; [10] "laws(130) 81.2%"       "law(129) 60%"          "just(128) 56.9%"      </span></span>
<span><span class="co">#&gt; [13] "interests(115) 57.6%"  "among(108) 62.9%"      "foreign(104) 72.2%"</span></span>
<span><span class="co">#&gt; ----- Featured words on Topic [2] -----</span></span>
<span><span class="co">#&gt;  [1] "may(343) 56.7%"          "one(267) 57.7%"         </span></span>
<span><span class="co">#&gt;  [3] "power(241) 91%"          "constitution(209) 88.6%"</span></span>
<span><span class="co">#&gt;  [5] "spirit(140) 76.5%"       "rights(138) 62.4%"      </span></span>
<span><span class="co">#&gt;  [7] "never(132) 57.2%"        "liberty(123) 69.8%"     </span></span>
<span><span class="co">#&gt;  [9] "well(120) 61.2%"         "duty(120) 51%"          </span></span>
<span><span class="co">#&gt; [11] "state(110) 76.1%"        "much(108) 53.3%"        </span></span>
<span><span class="co">#&gt; [13] "powers(101) 65.7%"</span></span>
<span><span class="co">#&gt; ----- Featured words on Topic [3] -----</span></span>
<span><span class="co">#&gt;  [1] "must(376) 61.4%"     "world(319) 97.6%"    "nation(305) 63.6%"  </span></span>
<span><span class="co">#&gt;  [4] "peace(258) 57.5%"    "new(250) 90.4%"      "time(220) 55.4%"    </span></span>
<span><span class="co">#&gt;  [7] "america(202) 100%"   "nations(199) 57.8%"  "freedom(185) 80.3%" </span></span>
<span><span class="co">#&gt; [10] "american(172) 59.9%" "let(160) 99.8%"      "make(147) 56.1%"    </span></span>
<span><span class="co">#&gt; [13] "justice(142) 52.1%"  "life(138) 73.9%"     "work(124) 90.9%"    </span></span>
<span><span class="co">#&gt; [16] "hope(120) 64.3%"     "know(111) 100%"      "fellow(110) 57.3%"  </span></span>
<span><span class="co">#&gt; [19] "history(105) 79.4%"  "today(105) 100%"</span></span></code></pre></div>
<p><em>(Note: Interpretation depends on the result. For example, one
topic might contain words like “government, people, states” (Political),
while another might have “world, peace, freedom”
(International).)</em></p>
</div>
</div>
<div class="section level2">
<h2 id="kernel-nmf-temporal-topic-evolution">4. Kernel NMF: Temporal Topic Evolution<a class="anchor" aria-label="anchor" href="#kernel-nmf-temporal-topic-evolution"></a>
</h2>
<p>One of the unique features of <code>nmfkc</code> is <strong>Kernel
NMF</strong>. In standard NMF, the order of documents is ignored; each
speech is treated independently. However, inaugural addresses have a
strong <strong>temporal component</strong>. By using the “Year” as a
covariate, we can smooth the topic proportions over time to see
historical shifts.</p>
<div class="section level3">
<h3 id="optimizing-the-kernel-parameter">Optimizing the Kernel Parameter<a class="anchor" aria-label="anchor" href="#optimizing-the-kernel-parameter"></a>
</h3>
<p>We construct a covariate matrix <code>U</code> using the year of the
address. We then find the optimal kernel bandwidth (<code>beta</code>)
using Cross-Validation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Covariate: Year of the address</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_corpus_inaugural</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optimize beta (Gaussian Kernel width)</span></span>
<span><span class="co"># We test a specific range of betas to locate the minimum CV error.</span></span>
<span><span class="va">beta_candidates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10000</span></span>
<span></span>
<span><span class="co"># Run CV to find the best beta</span></span>
<span><span class="co"># Note: We use the same rank (Q=3) as selected above.</span></span>
<span><span class="va">cv_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.beta.cv.html">nmfkc.kernel.beta.cv</a></span><span class="op">(</span><span class="va">Y</span>, rank <span class="op">=</span> <span class="va">rank</span>, U <span class="op">=</span> <span class="va">U</span>, beta <span class="op">=</span> <span class="va">beta_candidates</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; beta=2e-05...0.1sec</span></span>
<span><span class="co">#&gt; beta=5e-05...0sec</span></span>
<span><span class="co">#&gt; beta=1e-04...0sec</span></span>
<span><span class="co">#&gt; beta=2e-04...0sec</span></span>
<span><span class="co">#&gt; beta=5e-04...0sec</span></span>
<span><span class="va">best_beta</span> <span class="op">&lt;-</span> <span class="va">cv_res</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">best_beta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2e-04</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-kernel-nmf">Fitting Kernel NMF<a class="anchor" aria-label="anchor" href="#fitting-kernel-nmf"></a>
</h3>
<p>Now we fit the model using the kernel matrix <code>A</code>. This
enforces that documents close in time (similar years) should have
similar topic distributions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Kernel Matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.kernel.html">nmfkc.kernel</a></span><span class="op">(</span><span class="va">U</span>, beta <span class="op">=</span> <span class="va">best_beta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit NMF with Kernel Covariates</span></span>
<span><span class="va">res_ker</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmfkc.html">nmfkc</a></span><span class="op">(</span><span class="va">Y</span>, A <span class="op">=</span> <span class="va">A</span>, rank <span class="op">=</span> <span class="va">rank</span>, seed <span class="op">=</span> <span class="fl">123</span>, prefix <span class="op">=</span> <span class="st">"Topic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Y(67,59)~X(67,3)C(3,59)A(59,59)=XB(3,59)...0sec</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization-standard-vs-kernel-nmf">Visualization: Standard vs Kernel NMF<a class="anchor" aria-label="anchor" href="#visualization-standard-vs-kernel-nmf"></a>
</h3>
<p>Let’s compare how topic proportions change over time.</p>
<ul>
<li>
<strong>Standard NMF (Top):</strong> Shows noisy fluctuations. It
captures the specific content of each speech but misses the larger
historical context.</li>
<li>
<strong>Kernel NMF (Bottom):</strong> Reveals smooth historical
trends, showing how themes like “Nation Building” vs “Global Affairs”
have evolved over centuries.</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare Axis Labels (Rounded to integers)</span></span>
<span><span class="va">at_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">labels_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Standard NMF (Noisy)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">res_std</span><span class="op">$</span><span class="va">B.prob</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">rank</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span>, xaxt<span class="op">=</span><span class="st">'n'</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Standard NMF: Topic Proportions (Noisy)"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="va">at_points</span>, labels <span class="op">=</span> <span class="va">labels_years</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Kernel NMF (Smooth trend)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">res_ker</span><span class="op">$</span><span class="va">B.prob</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">rank</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span>, xaxt<span class="op">=</span><span class="st">'n'</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Kernel NMF: Temporal Topic Evolution (Smooth)"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="va">at_points</span>, labels <span class="op">=</span> <span class="va">labels_years</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">rank</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">rank</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="topic-modeling-with-nmfkc_files/figure-html/plot-comparison-1.png" width="768"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kenichi Satoh.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
